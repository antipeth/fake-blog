<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ATP</title>
     <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js" integrity="sha256-WCzAhd2P6gRJF9Hv3oOOd+hFJi/QJbv+Azn4CGB8gfY=" crossorigin="anonymous"></script>
     <script src="/js/index.js"></script>
     <script src="/js/prompt.js"></script>
     <script src="/js/keyboard.js"></script>
     <script src="/js/tab.js"></script>
     <script src="/js/commands.js"></script>
     <script src="/js/config.js"></script><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="/css/page.css"></head>
<body onkeydown='exec(event)'>
  <header>
      <h1>ATP</h1>
  </header>
  <main>
    <div class="files" id="files" tabindex="0">
<ul><li class="file">
    <span><a href='https://blog.0pt.icu/readme/'
      tabindex="-2">ï’¥  README</a></span>
  </li><li class="file">
    <span><a href='https://blog.0pt.icu/rss/'
      tabindex="-3">ï’¥  RSS</a></span>
  </li><li class="folder"><span>
      
      <a href='https://blog.0pt.icu/posts/'
        tabindex="-4">ï“  Posts
      </a>
    </span>

    <ul>
      
        
        
          
          
<li>
<span>â””â”€â”€
  
  <a href='https://blog.0pt.icu/posts/think/'
    tabindex="-5">ï“  Think
  </a>
</span>


  <ul>
  <li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/think/2024/'
        tabindex="-6">ï’¥  2024</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/think/unhappy-newyear/'
        tabindex="-7">ï’¥  ç¥ä½ æ˜¥èŠ‚ä¸å¿«ä¹</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/think/1st-anniversary-of-listening-to-tayu-lo/'
        tabindex="-8">ï’¥  çºªå¿µå¬ç½—å¤§ä½‘ä¸€å‘¨å¹´</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/think/music-history/'
        tabindex="-9">ï’¥  è®°æˆ‘çš„å¬æ­Œå†ç¨‹</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/think/my-first-post/'
        tabindex="-10">ï’¥  My first post</a>
    </span>
  </li></ul>
</li>

        
          
          
<li>
<span>â””â”€â”€
  
  <a href='https://blog.0pt.icu/posts/homelab/'
    tabindex="-11">ï“  homelab
  </a>
</span>


  <ul>
  <li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/homelab/nixos-nas/'
        tabindex="-12">ï’¥  My NixOS NASğŸ§Š</a>
    </span>
  </li></ul>
</li>

        
          
          
<li>
<span>â””â”€â”€
  
  <a href='https://blog.0pt.icu/posts/linux-trip/'
    tabindex="-13">ï“  Linux Trip
  </a>
</span>


  <ul>
  <li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/linux-trip/7/'
        tabindex="-14">ï’¥  ç¬¬ä¸ƒå›ï¼Œæ¢FreeBSDè·¯é€”è¿œï¼Œåå·è†æ£˜å‹‡å‰è¡Œ</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/linux-trip/6/'
        tabindex="-15">ï’¥  ç¬¬å…­å›ï¼Œå¼ƒLinuxæŠ•FreeBSDï¼Œç¨³å¦‚ç£çŸ³è·¯æ›´å®½</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/linux-trip/5/'
        tabindex="-16">ï’¥  ç¬¬äº”å›ï¼Œæ¸è§‰Archæ— åŠ›æŒï¼Œè½¬æŠ•NixOSè·æ–°ç”Ÿ</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/linux-trip/4/'
        tabindex="-17">ï’¥  ç¬¬å››å›ï¼ŒèˆKDEæŠ±Hyprlandï¼Œæ–°å¢ƒç•Œè¿½æ±‚æ›´æ·»</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/linux-trip/3/'
        tabindex="-18">ï’¥  ç¬¬ä¸‰å›ï¼Œæ¢å¹½å¯»ç§˜APPSæ–°ï¼Œè§£CONFIGå¥‡è¶£å…¥çœ¼å‰</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/linux-trip/2/'
        tabindex="-19">ï’¥  ç¬¬äºŒå›ï¼Œåˆå…¥KDEè™šç•Œé—´ï¼Œå®‰è£…APPSè€€ç›®å…‰</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/linux-trip/1/'
        tabindex="-20">ï’¥  ç¬¬ä¸€å›ï¼Œå¼ƒwindowæ¸å…¥è½»ç›ˆå¢ƒï¼Œè£…Archèµ°å…¥å‘æ·±åº•</a>
    </span>
  </li></ul>
</li>

        
          
          
<li>
<span>â””â”€â”€
  
  <a href='https://blog.0pt.icu/posts/k3s/'
    tabindex="-21">ï“  K3S
  </a>
</span>


  <ul>
  <li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/k3s/develop-rancher/'
        tabindex="-22">ï’¥  k3séƒ¨ç½²rancher</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a class="selected"href='https://blog.0pt.icu/posts/k3s/kubevirt-manager/'
        tabindex="-23">ï’¥  k3séƒ¨ç½²kubevirt-manager</a>
    </span>
  </li></ul>
</li>

        
          
          
<li>
<span>â””â”€â”€
  
  <a href='https://blog.0pt.icu/posts/pve/'
    tabindex="-24">ï“  PVE
  </a>
</span>


  <ul>
  <li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/pve/pve-hackintosh/'
        tabindex="-25">ï’¥  x79ä¸Špveé»‘è‹¹æœ</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/pve/build-pve/'
        tabindex="-26">ï’¥  x79æ­å»ºpveå¹¶å¼€å¯ç¡¬ä»¶ç›´é€š</a>
    </span>
  </li></ul>
</li>

        
          
          
<li>
<span>â””â”€â”€
  
  <a href='https://blog.0pt.icu/posts/server/'
    tabindex="-27">ï“  server
  </a>
</span>


  <ul>
  <li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/server/traefik-simple-guide/'
        tabindex="-28">ï’¥  Docker/NixOSä½¿ç”¨traefikå®ç°ç®€å•åä»£</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/server/caddy-simple-guide/'
        tabindex="-29">ï’¥  Debian/NixOSä½¿ç”¨caddyå®ç°ç®€å•åä»£</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/server/use-tebi-build-nixos-cache-server/'
        tabindex="-30">ï’¥  ä½¿ç”¨tebiä½œä¸ºs3,æ­å»ºnixç¼“å­˜æœåŠ¡å™¨</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/server/cloudfront-cdn-acme/'
        tabindex="-31">ï’¥  cloudfronté…ç½®å°é¸¡cdnå¹¶ä½¿ç”¨acme.shè‡ªåŠ¨è·å–è¯ä¹¦</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/server/build-terraria-tshock/'
        tabindex="-32">ï’¥  æ­å»ºæ³°æ‹‰ç‘äºšTshockæœåŠ¡å™¨(å¼ºåˆ¶å¼€è’)</a>
    </span>
  </li><li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/server/build-hugo/'
        tabindex="-33">ï’¥  åŸºäºArch Linuxæ­å»ºhugoåšå®¢</a>
    </span>
  </li></ul>
</li>

        
          
          
<li>
<span>â””â”€â”€
  
  <a href='https://blog.0pt.icu/posts/hackintosh/'
    tabindex="-34">ï“  Hackintosh
  </a>
</span>


  <ul>
  <li class="file">
    <span>â””â”€â”€
      <a href='https://blog.0pt.icu/posts/hackintosh/x79/'
        tabindex="-35">ï’¥  è®°å½•ä¸€æ¬¡æ‚ç‰Œx79é»‘è‹¹æœ</a>
    </span>
  </li></ul>
</li>

        
    </ul>
  </li><li class="folder"><span>
      
      <a href='https://blog.0pt.icu/about/'
        tabindex="-36">ï“  ABOUT
      </a>
    </span>

    <ul>
      <li class="file">
        <span>â””â”€â”€
          <a href='https://blog.0pt.icu/about/about2/'
            tabindex="-37">ï’¥  ABOUT2</a>
        </span>
      </li><li class="file">
        <span>â””â”€â”€
          <a href='https://blog.0pt.icu/about/about1/'
            tabindex="-38">ï’¥  ABOUT1</a>
        </span>
      </li>
        
    </ul>
  </li><li class="folder"><span>
      
      <a href='https://blog.0pt.icu/links/'
        tabindex="-39">ï“  LINKS
      </a>
    </span>

    <ul>
      <li class="file">
        <span>â””â”€â”€
          <a href='https://blog.0pt.icu/links/link/'
            tabindex="-40">ï’¥  LINKS</a>
        </span>
      </li>
        
    </ul>
  </li>
</ul>
</div>
    <div class="viewer page" id="viewer" tabindex="0">
      <div class="tab">
<ul id="tabs">
</ul>


</div>
      <div class="content" id="content"><h1 id="k3sbu-shu-kubevirt-manager">k3séƒ¨ç½²kubevirt-manager</h1>
<p>2024-11-08</p>
<p>å‚è€ƒ</p>
<ol>
<li>https://kubevirt.io/user-guide/</li>
<li>https://kubevirt-manager.io/get_started.html</li>
</ol>
<h1 id="an-zhuang-kubevirt">å®‰è£…kubevirt</h1>
<h2 id="an-zhuang-qemu-kvm-libvirt">å®‰è£…qemu_kvm,libvirt</h2>
<p>è‡ªè¡Œå®‰è£…</p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">pass
</span></code></pre>
<h2 id="an-zhuang-kubectl">å®‰è£…kubectl</h2>
<p>è‡ªè¡Œå®‰è£…</p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">pass
</span></code></pre>
<h2 id="an-zhuang-kind">å®‰è£…kind</h2>
<p>è‡ªè¡Œå®‰è£…</p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">pass
</span></code></pre>
<h2 id="she-zhi-mo-ren-wen-jian">è®¾ç½®é»˜è®¤æ–‡ä»¶</h2>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">mkdir</span><span style="color:#ffcc66;"> -p</span><span> /root/.kube
</span><span style="color:#ffd580;">cp</span><span> /etc/rancher/k3s/k3s.yaml /root/.kube/config
</span><span style="color:#ffd580;">kubectl</span><span> get nodes
</span></code></pre>
<h2 id="shi-yong-kubectlan-zhuang-kubevirt-operator">ä½¿ç”¨kubectlå®‰è£…kubevirt operator</h2>
<p>å¯ä»¥ä½¿ç”¨ KubeVirt Operator å®‰è£… KubeVirtï¼Œè¯¥ Operator ç®¡ç†æ‰€æœ‰ KubeVirt æ ¸å¿ƒç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffa759;">export </span><span>VERSION</span><span style="color:#f29e74;">=</span><span style="color:#bae67e;">$</span><span>(</span><span style="color:#ffd580;">curl</span><span style="color:#ffcc66;"> -s</span><span style="color:#bae67e;"> https://storage.googleapis.com/kubevirt-prow/release/kubevirt/kubevirt/stable.txt</span><span>)
</span><span style="color:#f28779;">echo </span><span>$VERSION
</span><span style="color:#ffd580;">kubectl</span><span> create</span><span style="color:#ffcc66;"> -f </span><span style="color:#bae67e;">&quot;https://github.com/kubevirt/kubevirt/releases/download/$</span><span>{VERSION}</span><span style="color:#bae67e;">/kubevirt-operator.yaml&quot;
</span></code></pre>
<h2 id="shi-yong-kubectl-bu-shu-kubevirt-zi-ding-yi-zi-yuan-ding-yi">ä½¿ç”¨ kubectl éƒ¨ç½² KubeVirt è‡ªå®šä¹‰èµ„æºå®šä¹‰</h2>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">kubectl</span><span> create</span><span style="color:#ffcc66;"> -f </span><span style="color:#bae67e;">&quot;https://github.com/kubevirt/kubevirt/releases/download/$</span><span>{VERSION}</span><span style="color:#bae67e;">/kubevirt-cr.yaml&quot;
</span></code></pre>
<h2 id="yan-zheng-bu-shu">éªŒè¯éƒ¨ç½²</h2>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">kubectl</span><span> get kubevirt.kubevirt.io/kubevirt</span><span style="color:#ffcc66;"> -n</span><span> kubevirt</span><span style="color:#ffcc66;"> -o</span><span style="color:#f29e74;">=</span><span>jsonpath=</span><span style="color:#bae67e;">&quot;{.status.phase}&quot;
</span></code></pre>
<p>éœ€è¦ç­‰ä¸Šä¸€ä¼š</p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">kubectl</span><span> get all</span><span style="color:#ffcc66;"> -n</span><span> kubevirt
</span></code></pre>
<p>ç­‰åˆ°çŠ¶æ€ä¸º<code>Deployed</code>å³å®Œæˆ
é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubeVirt å°†éƒ¨ç½² 7 ä¸ª Podã€3 ä¸ªæœåŠ¡ã€1 ä¸ª daemonsetã€3 ä¸ªéƒ¨ç½²åº”ç”¨ã€3 ä¸ªå‰¯æœ¬é›†</p>
<h2 id="an-zhuang-virt-optional">å®‰è£…virt (optional)</h2>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">kubectl</span><span> krew install virt
</span></code></pre>
<h1 id="an-zhuang-kubevirt-manager">å®‰è£…kubevirt-manager</h1>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>
</span><span># åˆ›å»º`storageclass.yaml`æ–‡ä»¶
</span><span># 
</span><span># ```storageclass.yaml
</span><span># apiVersion: storage.k8s.io/v1
</span><span># kind: StorageClass
</span><span># metadata:
</span><span>#   name: local-path
</span><span># provisioner: rancher.io/local-path
</span><span># allowVolumeExpansion: true
</span><span># volumeBindingMode: WaitForFirstConsumer
</span></code></pre>
<p>ä½¿ç”¨é»˜è®¤é…ç½®</p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">kubectl</span><span> apply</span><span style="color:#ffcc66;"> -f</span><span> https://raw.githubusercontent.com/kubevirt-manager/kubevirt-manager/main/kubernetes/bundled.yaml
</span></code></pre>
<p>æ¥ä¸‹æ¥ï¼Œè·å–èŠ‚ç‚¹ipè¿›è¡Œè®¿é—®</p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">kubectl</span><span> get service kubevirt-manager</span><span style="color:#ffcc66;"> -n</span><span> kubevirt-manager
</span></code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>NAME               TYPE       CLUSTER-IP        EXTERNAL-IP   PORT(S)       AGE
</span><span>kubevirt-manager   NodePort   your-cluster-ip   &lt;none&gt;        8080/TCP      11m
</span></code></pre>
<p>or</p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">git</span><span> clone https://github.com/kubevirt-manager/kubevirt-manager.git
</span><span style="color:#f28779;">cd</span><span> kubevirt-manager
</span><span style="color:#ffd580;">kubectl</span><span> apply</span><span style="color:#ffcc66;"> -f</span><span> kubernetes/ns.yaml
</span><span style="color:#ffd580;">kubectl</span><span> apply</span><span style="color:#ffcc66;"> -f</span><span> kubernetes/crd.yaml
</span><span style="color:#ffd580;">kubectl</span><span> apply</span><span style="color:#ffcc66;"> -f</span><span> kubernetes/rbac.yaml
</span><span style="color:#ffd580;">kubectl</span><span> apply</span><span style="color:#ffcc66;"> -f</span><span> kubernetes/pc.yaml
</span><span style="color:#ffd580;">kubectl</span><span> apply</span><span style="color:#ffcc66;"> -f</span><span> kubernetes/service.yaml
</span></code></pre>
<p>ä¸ºäº†å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ipè®¿é—®virt-manager</p>
<p>å°†åŸ<code>kubernetes/service.yaml</code></p>
<pre data-lang="kubernetes/service.yaml" style="background-color:#212733;color:#ccc9c2;" class="language-kubernetes/service.yaml "><code class="language-kubernetes/service.yaml" data-lang="kubernetes/service.yaml"><span>apiVersion: v1
</span><span>kind: Service
</span><span>metadata:
</span><span>  name: kubevirt-manager
</span><span>  namespace: kubevirt-manager
</span><span>  labels:
</span><span>    app: kubevirt-manager
</span><span>    kubevirt-manager.io/version: 1.4.1
</span><span>spec:
</span><span>  type: ClusterIP
</span><span>  selector:
</span><span>    app: kubevirt-manager
</span><span>  ports:
</span><span>    - protocol: TCP
</span><span>      port: 8080
</span><span>      targetPort: 8080
</span></code></pre>
<p>ä¸­çš„ <code>ClusterIP</code> ä¿®æ”¹ä¸º<code>NodePort</code>,ä¸”å¯ä»¥æ·»åŠ æ˜ å°„å‡ºå»çš„ç«¯å£,ä¿®æ”¹åå¦‚ä¸‹</p>
<pre data-lang="kubernetes/service.yaml" style="background-color:#212733;color:#ccc9c2;" class="language-kubernetes/service.yaml "><code class="language-kubernetes/service.yaml" data-lang="kubernetes/service.yaml"><span>apiVersion: v1
</span><span>kind: Service
</span><span>metadata:
</span><span>  name: kubevirt-manager
</span><span>  namespace: kubevirt-manager
</span><span>  labels:
</span><span>    app: kubevirt-manager
</span><span>    kubevirt-manager.io/version: 1.4.1
</span><span>spec:
</span><span>  type: NodePort
</span><span>  selector:
</span><span>    app: kubevirt-manager
</span><span>  ports:
</span><span>    - protocol: TCP
</span><span>      port: 8080
</span><span>      targetPort: 8080
</span><span>      nodePort: 30080  # å¦‚æœä½¿ç”¨ NodePortï¼Œå¯ä»¥æŒ‡å®šç«¯å£å·
</span></code></pre>
<p>å†æ¬¡åº”ç”¨<code>kubernetes/service.yaml</code></p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">kubectl</span><span> apply</span><span style="color:#ffcc66;"> -f</span><span> kubernetes/service.yaml
</span></code></pre>
<p>æ¥ä¸‹æ¥ï¼Œè·å–èŠ‚ç‚¹ipè¿›è¡Œè®¿é—®</p>
<pre data-lang="bash" style="background-color:#212733;color:#ccc9c2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#ffd580;">kubectl</span><span> get service kubevirt-manager</span><span style="color:#ffcc66;"> -n</span><span> kubevirt-manager
</span></code></pre>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>NAME               TYPE       CLUSTER-IP        EXTERNAL-IP   PORT(S)           AGE
</span><span>kubevirt-manager   NodePort   your-cluster-ip   &lt;none&gt;        8080:30080/TCP    11m
</span></code></pre>

      </div>
    </div>
    <div class="prompt" id="terminal"><input
    type="text"
    id="setter"
    onkeydown="writeit(this, event);moveIt(this.value.length, event)"
    onchange="writeit(this, event)"
    onkeyup="writeit(this, event)"
    onkeypress="writeit(this, event);"
    >
<label for="setter" id="writer"> </label><b class="cursor" id="cursor"></b></div>
  </main>
</body>
</html>
